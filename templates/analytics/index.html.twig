{% extends 'base.html.twig' %}

{% block title %}Analytics Trading{% endblock %}

{% block body %}
    <div class="wrapper-container">
        <!-- Statistiques globales -->
        <div class="stats-grid">
            {% include 'components/stats_card.html.twig' with {
                title: 'Investi',
                value: (stats.global.investedAmount / 1000000)|number_format(1) ~ 'M',
                subtitle: stats.global.availableLots ~ ' lots disponibles',
                icon: 'üí∞',
                color: 'orange'
            } %}
            {% include 'components/stats_card.html.twig' with {
                title: 'Profit R√©alis√©',
                value: (stats.global.realizedProfit / 1000000)|number_format(1) ~ 'M',
                subtitle: stats.global.soldLots ~ ' lots vendus',
                icon: '‚úÖ',
                color: 'green'
            } %}
            {% include 'components/stats_card.html.twig' with {
                title: 'Profit Potentiel',
                value: (stats.global.potentialProfit / 1000000)|number_format(1) ~ 'M',
                subtitle: 'Si tout vendu au prix cible',
                icon: 'üéØ',
                color: 'blue'
            } %}
            {% include 'components/stats_card.html.twig' with {
                title: 'Total Lots',
                value: stats.global.totalLots,
                subtitle: stats.charactersCount ~ ' personnages',
                icon: 'üìä',
                color: 'purple'
            } %}
        </div>

        <!-- Top items rentables -->
        <div class="stats-grid-2">
            <div class="wrapper-background">
                <h3 class="text-white text-xl font-semibold mb-4">üèÜ Top Items Rentables</h3>
                {% if stats.topItems|length > 0 %}
                    <div class="space-y-3">
                        {% for item in stats.topItems %}
                            {% set profit = item.totalProfit %}
                            <div class="flex justify-between items-center p-4 bg-gray-700 rounded-lg">
                                <div>
                                    <div class="text-white font-medium">{{ item.itemName }}</div>
                                    <div class="text-gray-400 text-sm">{{ item.lotsCount }} lots</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-{{ profit >= 0 ? 'green' : 'red' }}-400 font-bold">
                                        {{ (profit / 1000000)|number_format(1) }}M
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-400">Aucun item trad√© pour le moment</p>
                {% endif %}
            </div>
        </div>

        <!-- Ratios et m√©triques -->
        {% if stats.global.totalLots > 0 %}
            <div class="wrapper-background">
                <h3 class="page-title">üìä M√©triques Cl√©s</h3>
                <div class="stats-grid-3">
                    <div class="text-center">
                        <div class="stats-value-primary">
                            {{ ((stats.global.soldLots / stats.global.totalLots) * 100)|number_format(1) }}%
                        </div>
                        <div class="stats-subtitle">Taux de vente</div>
                    </div>
                    <div class="text-center">
                        <div class="stats-value-success">
                            {% set totalProfit = stats.global.realizedProfit + stats.global.potentialProfit %}
                            {% set roi = stats.global.investedAmount > 0 ? (totalProfit / stats.global.investedAmount * 100) : 0 %}
                            {{ roi|number_format(1) }}%
                        </div>
                        <div class="stats-subtitle">ROI Total</div>
                    </div>
                    <div class="text-center">
                        <div class="stats-value-warning">
                            {{ (stats.global.totalLots / stats.charactersCount)|number_format(1) }}
                        </div>
                        <div class="stats-subtitle">Lots par personnage</div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}