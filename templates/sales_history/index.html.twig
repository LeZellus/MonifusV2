{% extends 'base.html.twig' %}

{% block title %}Historique des Ventes{% endblock %}

{% block navbar %}
    {% include 'components/navbar.html.twig' with {
        'title': 'Historique des Ventes',
        'back_url': path('app_trading_dashboard'),
        'back_label': '‚Üê Dashboard'
    } %}
{% endblock %}

{% block body %}
    <div class="wrapper-container">
        <!-- S√©lecteur de personnage -->
        {% include 'components/character_selector.html.twig' %}

        <!-- Statistiques des ventes -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-white text-lg font-semibold mb-2">üí∞ Profit R√©alis√©</h3>
                <p class="text-green-400 text-2xl font-bold">
                    {{ (total_realized_profit / 1000000)|number_format(1) }}M
                </p>
            </div>
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-white text-lg font-semibold mb-2">üéØ Profit Attendu</h3>
                <p class="text-blue-400 text-2xl font-bold">
                    {{ (total_expected_profit / 1000000)|number_format(1) }}M
                </p>
            </div>
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-white text-lg font-semibold mb-2">üìä Diff√©rence</h3>
                <p class="text-{{ profit_difference >= 0 ? 'green' : 'red' }}-400 text-2xl font-bold">
                    {{ profit_difference >= 0 ? '+' : '' }}{{ (profit_difference / 1000000)|number_format(1) }}M
                </p>
            </div>
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-white text-lg font-semibold mb-2">üìà Ventes Total</h3>
                <p class="text-purple-400 text-2xl font-bold">{{ sales|length }}</p>
            </div>
        </div>

        <!-- Filtres -->
        <div class="wrapper-background">
            <form method="GET" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                <div>
                    <label class="block text-white font-medium mb-2">P√©riode</label>
                    <select name="period" class="w-full px-3 py-2 border border-gray-600 bg-gray-700 text-white rounded-md">
                        <option value="7" {{ current_filters.period == '7' ? 'selected' : '' }}>7 derniers jours</option>
                        <option value="30" {{ current_filters.period == '30' ? 'selected' : '' }}>30 derniers jours</option>
                        <option value="90" {{ current_filters.period == '90' ? 'selected' : '' }}>3 derniers mois</option>
                        <option value="365" {{ current_filters.period == '365' ? 'selected' : '' }}>Derni√®re ann√©e</option>
                        <option value="all" {{ current_filters.period == 'all' ? 'selected' : '' }}>Toute la p√©riode</option>
                    </select>
                </div>

                <div class="flex space-x-2">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors">
                        Filtrer
                    </button>
                    <a href="{{ path('app_sales_history_index') }}" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md transition-colors">
                        Reset
                    </a>
                </div>
            </form>
        </div>

        <div class="flex justify-between items-center">
            <h2 class="text-white text-2xl font-bold">
                Historique des Ventes
                {% if selectedCharacter %}
                    - {{ selectedCharacter.name }}
                {% endif %}
            </h2>
            {% if sales|length > 0 %}
                <a href="{{ path('app_sales_history_export', app.request.query.all) }}" 
                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                    üìä Exporter CSV
                </a>
            {% endif %}
        </div>

        {% include 'components/data_table.html.twig' with {
            headers: ['Date Vente', 'Item', 'Personnage', 'Quantit√©', 'Prix R√©el', 'Prix Attendu', 'Profit Total', 'Performance', 'Notes'],
            rows: sales,
            row_template: 'sales_history/_table_row.html.twig',
            empty_message: 'Aucune vente enregistr√©e pour le moment',
            empty_action: {
                url: path('app_lot_index'),
                text: 'Voir mes lots disponibles'
            }
        } %}
    </div>
{% endblock %}