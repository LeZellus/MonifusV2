{% extends 'base.html.twig' %}

{% block title %}Nouvelle Observation - {{ character.name }}{% endblock %}

{% block navbar %}
    {% include 'components/navbar.html.twig' with {
        'title': 'Nouvelle Observation - ' ~ character.name,
        'back_url': path('app_market_watch_index')
    } %}
{% endblock %}

{% block body %}
    <div class="wrapper-container">
        <div class="max-w-2xl mx-auto">
            <!-- En-t√™te avec info personnage -->
            {% include 'components/character_info_header.html.twig' with {
                character: character,
                action_title: 'Nouvelle Observation',
                action_description: 'Observer les prix du march√©',
                action_color: 'orange',
                action_icon: 'üìä'
            } %}

            <!-- Explication du syst√®me -->
            {% set explanation_content %}
                <p>‚Ä¢ üìã Observez les prix sur l'h√¥tel de vente de votre serveur</p>
                <p>‚Ä¢ üî¢ Notez les prix par unit√© (x1), par 10 (x10) et/ou par 100 (x100)</p>
                <p>‚Ä¢ üìà R√©p√©tez r√©guli√®rement pour suivre l'√©volution des prix</p>
                <p>‚Ä¢ üí∞ Identifiez les meilleures opportunit√©s d'achat/vente</p>
            {% endset %}

            <div class="mb-6">
                {% include 'components/info_box.html.twig' with {
                    title: 'Comment √ßa marche ?',
                    icon: 'üí°',
                    color: 'orange',
                    content: explanation_content
                } %}
            </div>

            <!-- Formulaire principal -->
            {% set form_content %}
                {{ form_start(form) }}
                    <div class="space-y-6">
                        <!-- Ressource avec autocompl√©tion -->
                        {% include 'components/autocomplete_field.html.twig' with {
                            form: form,
                            search_field: 'itemSearch',
                            hidden_field: 'item', 
                            api_url: path('api_items_search_resources'),
                            container_class: '',
                            label: 'Rechercher une ressource',
                            placeholder: 'Tapez pour rechercher une ressource...',
                            help_text: 'üîç Recherche filtr√©e sur les ressources'
                        } %}

                        <!-- Date d'observation -->
                        <div>
                            {{ form_label(form.observedAt, null, {'label_attr': {'class': 'block text-white font-medium mb-2'}}) }}
                            {{ form_widget(form.observedAt, {'attr': {'class': 'w-full px-3 py-2 border border-gray-600 bg-gray-700 text-white rounded-md focus:outline-none focus:border-orange-500'}}) }}
                            {{ form_errors(form.observedAt) }}
                            <div class="form-help">üìÖ Quand avez-vous observ√© ces prix ?</div>
                        </div>

                        <!-- Prix observ√©s -->
                        <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-4">
                            <h4 class="text-white font-semibold mb-4 flex items-center">
                                <span class="mr-2">üí∞</span>
                                Prix observ√©s sur l'h√¥tel de vente
                            </h4>
                            <div class="text-blue-100 text-sm mb-4">
                                Renseignez au moins un prix. Laissez vide si cette unit√© n'est pas disponible.
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                    {{ form_label(form.pricePerUnit, null, {'label_attr': {'class': 'block text-white font-medium mb-2'}}) }}
                                    <div class="relative">
                                        {{ form_widget(form.pricePerUnit, {'attr': {'class': 'w-full px-4 py-3 pr-12 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:border-green-500'}}) }}
                                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                            <span class="text-gray-400 text-sm">kamas</span>
                                        </div>
                                    </div>
                                    {{ form_errors(form.pricePerUnit) }}
                                    <div class="text-green-200 text-xs mt-1">Prix d'1 seule unit√©</div>
                                </div>

                                <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                    {{ form_label(form.pricePer10, null, {'label_attr': {'class': 'block text-white font-medium mb-2'}}) }}
                                    <div class="relative">
                                        {{ form_widget(form.pricePer10, {'attr': {'class': 'w-full px-4 py-3 pr-12 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:border-blue-500'}}) }}
                                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                            <span class="text-gray-400 text-sm">kamas</span>
                                        </div>
                                    </div>
                                    {{ form_errors(form.pricePer10) }}
                                    <div class="text-blue-200 text-xs mt-1">Prix d'un lot de 10</div>
                                </div>

                                <div class="bg-white bg-opacity-10 rounded-lg p-4">
                                    {{ form_label(form.pricePer100, null, {'label_attr': {'class': 'block text-white font-medium mb-2'}}) }}
                                    <div class="relative">
                                        {{ form_widget(form.pricePer100, {'attr': {'class': 'w-full px-4 py-3 pr-12 border border-gray-600 bg-gray-700 text-white rounded-lg focus:outline-none focus:border-purple-500'}}) }}
                                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                            <span class="text-gray-400 text-sm">kamas</span>
                                        </div>
                                    </div>
                                    {{ form_errors(form.pricePer100) }}
                                    <div class="text-purple-200 text-xs mt-1">Prix d'un lot de 100</div>
                                </div>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div>
                            {{ form_label(form.notes, null, {'label_attr': {'class': 'block text-white font-medium mb-2'}}) }}
                            {{ form_widget(form.notes, {'attr': {'class': 'w-full px-3 py-2 border border-gray-600 bg-gray-700 text-white rounded-md focus:outline-none focus:border-orange-500', 'rows': 3}}) }}
                            {{ form_errors(form.notes) }}
                            <div class="form-help">üìù Contexte du march√©, tendances observ√©es...</div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="mt-8">
                        {% include 'components/action_buttons.html.twig' with {
                            submit_text: 'Enregistrer l\'observation',
                            submit_icon: 'üìä',
                            submit_color: 'warning',
                            cancel_url: path('app_market_watch_index'),
                            cancel_icon: '‚ùå'
                        } %}
                    </div>
                {{ form_end(form) }}
            {% endset %}

            {% include 'components/form_section.html.twig' with {
                title: 'Observer les prix du march√©',
                icon: 'üìù',
                color: 'orange',
                content: form_content
            } %}
        </div>
    </div>

    <!-- CSS pour l'autocompl√©tion -->
    <style>
        .autocomplete-item {
            transition: background-color 0.2s;
        }
        .autocomplete-item:hover {
            background-color: rgba(55, 65, 81, 0.8);
        }
    </style>
{% endblock %}