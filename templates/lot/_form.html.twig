<!-- templates/lot/_form.html.twig -->
<div class="max-w-3xl mx-auto" data-controller="centralized-calculator" data-centralized-calculator-mode-value="lot">

    {{ form_start(form) }}

    <!-- En-tÃªte avec Item -->
    <div class="wrapper-background mb-6">
        <div class="flex items-center gap-3 mb-4">
            <span class="text-2xl">ðŸ“¦</span>
            <h2 class="text-xl font-semibold text-white">{{ is_edit ? 'Modifier le lot' : 'Nouveau lot' }}</h2>
        </div>

        {% if is_edit %}
            {% include 'components/autocomplete_field.html.twig' with {
                form: form,
                search_field: 'itemSearch',
                hidden_field: 'item',
                is_readonly: true,
                current_item: lot.item,
                label: 'Item',
                readonly_help: 'Non modifiable'
            } %}
        {% else %}
            {% include 'components/autocomplete_field.html.twig' with {
                form: form,
                search_field: 'itemSearch',
                hidden_field: 'item',
                api_url: path('api_items_search'),
                label: 'Item',
                placeholder: 'Rechercher un item...',
                help_text: ''
            } %}
        {% endif %}
    </div>

    <!-- Configuration Achat / Vente cÃ´te Ã  cÃ´te -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">

        <!-- ACHAT -->
        <div class="wrapper-background">
            <div class="flex items-center gap-2 mb-4 pb-3 border-b border-gray-700">
                <span class="w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center text-red-400">â†“</span>
                <h3 class="text-white font-medium">Achat</h3>
            </div>

            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="form-label text-gray-400 text-xs">Lot HDV</label>
                        {{ form_widget(form.buyUnit, {'attr': {
                            'class': 'form-input-lg h-12 text-sm',
                            'data-centralized-calculator-target': 'buyUnit',
                            'data-action': 'change->centralized-calculator#updateCalculations'
                        }}) }}
                    </div>
                    <div>
                        <label class="form-label text-gray-400 text-xs">QuantitÃ©</label>
                        {{ form_widget(form.lotSize, {'attr': {
                            'class': 'form-input-lg h-12 text-sm',
                            'placeholder': '3',
                            'data-centralized-calculator-target': 'lotSize',
                            'data-action': 'input->centralized-calculator#updateCalculations'
                        }}) }}
                    </div>
                </div>

                <div>
                    <label class="form-label text-gray-400 text-xs">Prix par lot</label>
                    <div class="relative">
                        {{ form_widget(form.buyPricePerLot, {'attr': {
                            'class': 'form-input-lg h-12 pr-16',
                            'placeholder': '9000',
                            'data-centralized-calculator-target': 'buyPrice',
                            'data-action': 'input->centralized-calculator#updateCalculations'
                        }}) }}
                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm">kamas</span>
                    </div>
                </div>

                <!-- RÃ©sumÃ© achat -->
                <div class="bg-gray-800/50 rounded-lg p-3 mt-2">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400 text-sm">Total items</span>
                        <span data-centralized-calculator-target="totalQuantity" class="text-white font-medium">0</span>
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <span class="text-gray-400 text-sm">Investissement</span>
                        <span data-centralized-calculator-target="investment" class="text-red-400 font-bold">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- VENTE -->
        <div class="wrapper-background">
            <div class="flex items-center gap-2 mb-4 pb-3 border-b border-gray-700">
                <span class="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center text-green-400">â†‘</span>
                <h3 class="text-white font-medium">Revente</h3>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="form-label text-gray-400 text-xs">Lot HDV</label>
                    {{ form_widget(form.saleUnit, {'attr': {
                        'class': 'form-input-lg h-12 text-sm',
                        'data-centralized-calculator-target': 'saleUnit',
                        'data-action': 'change->centralized-calculator#updateCalculations'
                    }}) }}
                </div>

                <div>
                    <label class="form-label text-gray-400 text-xs">Prix par lot</label>
                    <div class="relative">
                        {{ form_widget(form.sellPricePerLot, {'attr': {
                            'class': 'form-input-lg h-12 pr-16',
                            'placeholder': '1600',
                            'data-centralized-calculator-target': 'sellPrice',
                            'data-action': 'input->centralized-calculator#updateCalculations'
                        }}) }}
                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm">kamas</span>
                    </div>
                </div>

                <!-- RÃ©sumÃ© vente -->
                <div class="bg-gray-800/50 rounded-lg p-3 mt-2">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400 text-sm">Lots Ã  vendre</span>
                        <span data-centralized-calculator-target="sellLotCount" class="text-white font-medium">0</span>
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <span class="text-gray-400 text-sm">Revenu total</span>
                        <span data-centralized-calculator-target="totalRevenue" class="text-green-400 font-bold">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RÃ©sumÃ© & Profit -->
    <div class="wrapper-background mb-6">
        <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
            <!-- Statut -->
            <div style="margin-bottom: 0;">
                <label class="form-label">Statut</label>
                <div class="mt-2">
                    <div class="relative inline-flex items-center"
                         data-controller="toggle"
                         data-toggle-on-value-value="sold"
                         data-toggle-off-value-value="available">
                        {{ form_widget(form.status, {'attr': {'class': 'sr-only', 'data-toggle-target': 'input'}}) }}
                        <button type="button" class="toggle-switch" data-action="click->toggle#switch">
                            <span class="toggle-slider"></span>
                        </button>
                        <div class="ml-4 flex items-center space-x-4">
                            <span class="toggle-label toggle-label-off">Disponible</span>
                            <span class="toggle-label toggle-label-on">Vendu</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profit -->
            <div style="text-align: right;">
                <div class="text-gray-400 text-sm mb-1">Profit total estimÃ©</div>
                <div data-centralized-calculator-target="totalProfit" class="text-3xl font-bold text-green-400">0</div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="flex gap-3">
        <a href="{{ path('app_lot_index') }}" class="btn btn-secondary flex-1 justify-center">
            Annuler
        </a>
        <button type="submit" class="btn btn-success flex-1 justify-center">
            {{ is_edit ? 'Enregistrer' : 'CrÃ©er le lot' }}
        </button>
    </div>

    {{ form_end(form) }}
</div>
