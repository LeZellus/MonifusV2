<tr class="table-row">
    <td class="table-cell">
        {% include 'components/item_display.html.twig' with {item: item.item} %}
    </td>
    <td class="table-cell">
        <div class="text-white font-medium">{{ item.totalItems|number_format(0, ',', ' ') }} items</div>
        <div class="text-gray-400 text-sm">{{ item.lotSize }}√ó{{ item.buyUnit.value }} ‚Üí {{ item.sellLotCount }}√ó{{ item.saleUnit.value }}</div>
    </td>
    <td class="table-cell">
        {{ price(item.buyPricePerLot, 'white') }}
        <div class="text-gray-400 text-sm">par lot</div>
    </td>
    <td class="table-cell">
        {% if item.status.value == 'sold' and item.lotUnits|length > 0 %}
            {# Si vendu, afficher le prix r√©el de la derni√®re vente #}
            {% set lastSale = item.lotUnits|last %}
            {{ price(lastSale.actualSellPrice, 'white') }}
            <div class="text-gray-400 text-sm">prix r√©el</div>
        {% else %}
            {# Sinon, toujours "√Ä d√©finir" #}
            <span class="text-gray-500 italic">√Ä d√©finir</span>
            <div class="text-gray-400 text-sm">lors de la vente</div>
        {% endif %}
    </td>
    <td class="table-cell">
        {% if item.status.value == 'sold' and item.lotUnits|length > 0 %}
            {# Profit avec prix r√©el de vente #}
            {% set lastSale = item.lotUnits|last %}
            {{ sale_profit(lastSale) }}
        {% elseif item.sellPricePerLot %}
            {# Profit estim√© #}
            {{ profit(item) }}
        {% else %}
            <span class="text-gray-500">-</span>
        {% endif %}
    </td>
    <td class="table-cell">
        <span class="status-{{ item.status.value == 'available' ? 'available' : 'sold' }}">
            {{ item.status.value == 'available' ? 'En attente' : 'Vendu' }}
        </span>
    </td>
    <td class="table-cell">
        <div class="action-group">
            {# Action principale visible #}
            {% if item.status.value == 'available' %}
                <a href="{{ path('app_lot_sell', {id: item.id}) }}" 
                class="text-green-400 hover:text-green-300">
                    Vendre
                </a>
            {% endif %}
            
            <a href="{{ path('app_lot_edit', {id: item.id}) }}" 
            class="text-blue-400 hover:text-blue-300">
                Modifier
            </a>
            
            {# Actions secondaires dans un menu compact #}
            <div class="relative inline-block">
                <button type="button" 
                        class="text-gray-400 hover:text-white text-sm px-2 py-1 rounded"
                        onclick="this.nextElementSibling.classList.toggle('hidden')">
                    ‚ãØ
                </button>
                
                <div class="hidden absolute right-0 top-full mt-1 w-40 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-10 py-1">
                    {% if item.lotUnits|length > 0 %}
                        {% set lastSale = item.lotUnits|last %}
                        <form action="{{ path('app_lot_unit_cancel', {id: lastSale.id}) }}" method="post" 
                            onsubmit="return confirm('Annuler la vente de {{ lastSale.quantitySold }} lots ?')" 
                            class="block">
                            <button type="submit" class="w-full text-left px-3 py-2 text-orange-400 hover:bg-gray-700 text-sm">
                                üîÑ Annuler vente
                            </button>
                        </form>
                    {% endif %}
                    
                    <form action="{{ path('app_lot_delete', {id: item.id}) }}" method="post"
                        onsubmit="return confirm('Supprimer ce lot d√©finitivement ?')"
                        class="block">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ item.id) }}">
                        <button type="submit" class="w-full text-left px-3 py-2 text-red-400 hover:bg-gray-700 text-sm">
                            üóëÔ∏è Supprimer
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </td>
</tr>
